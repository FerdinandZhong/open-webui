---
# Configuration file for CML jobs
# Contains all job definitions and their parameters

jobs:
  # Git sync job to update repository code
  git_sync:
    name: "Git Repository Sync"
    script: ".git_sync.py"
    arguments: ""
    kernel: "python3"
    runtime_id: "docker.repository.cloudera.com/cloudera/cdsw/ml-runtime-pbj-jupyterlab-python3.11-standard:2025.01.3-b8"
    cpu: 1
    memory: 2
    gpu: 0
    timeout: 300
    environment:
      GITHUB_TOKEN: "${GITHUB_TOKEN}"  # Will be replaced at runtime

  create_env:
    name: Create Python Environment
    script: scripts/setup_environment.py
    kernel: python3
    runtime_id: "docker.repository.cloudera.com/cloudera/cdsw/ml-runtime-pbj-jupyterlab-python3.11-standard:2025.01.3-b8"
    cpu: 1
    memory: 2
    timeout: 1800  # 30 minutes
    environment: {}
    arguments: ""

  download_ofac_list:
    name: Download OFAC List
    script: data_list/pipeline.py
    kernel: python3
    runtime_id: "docker.repository.cloudera.com/cloudera/cdsw/ml-runtime-pbj-jupyterlab-python3.11-standard:2025.01.3-b8"
    cpu: 2
    memory: 4
    timeout: 600  # 10 minutes
    parent_job_key: "create_env"
    arguments: "--quick"
    environment:
      DATA_DIR: "data_list"
    
  run_sdn_application:
    name: Run SDN Screening Application
    script: scripts/run_merged_app.py
    kernel: python3
    runtime_id: "docker.repository.cloudera.com/cloudera/cdsw/ml-runtime-pbj-jupyterlab-python3.11-standard:2025.01.3-b8"
    cpu: 4
    memory: 8
    timeout: 0  # Run indefinitely
    parent_job_key: "download_ofac_list"
    arguments: ""
    environment:
      USE_LLM: "true"
      OPENAI_API_KEY: "${OPENAI_API_KEY}"
      FLASK_ENV: "production"
      CDSW_READONLY_PORT: "8090"
