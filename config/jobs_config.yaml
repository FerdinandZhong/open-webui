---
# Configuration file for CML jobs
# Contains all job definitions and their parameters

jobs:
  # Git sync job to update repository code
  git_sync:
    name: "Git Repository Sync"
    script: ".git_sync.py"
    arguments: ""
    kernel: "python3"
    runtime_id: "docker.repository.cloudera.com/cloudera/cdsw/ml-runtime-pbj-jupyterlab-python3.11-standard:2025.01.3-b8"
    cpu: 1
    memory: 2
    gpu: 0
    timeout: 300
    environment:
      GITHUB_TOKEN: "${GITHUB_TOKEN}"  # Will be replaced at runtime

  create_env:
    name: Create Python Environment
    script: create_environment.py
    kernel: python3
    runtime_id: "docker.repository.cloudera.com/cloudera/cdsw/ml-runtime-pbj-jupyterlab-python3.11-standard:2025.01.3-b8"
    cpu: 1
    memory: 2
    timeout: 1800  # 30 minutes
    environment: {}
    arguments: ""

  download_ofac_list:
    name: Download OFAC List
    script: data_list/pipeline.py
    kernel: python3
    runtime_id: "docker.repository.cloudera.com/cloudera/cdsw/ml-runtime-pbj-jupyterlab-python3.11-standard:2025.01.3-b8"
    cpu: 2
    memory: 4
    timeout: 600  # 10 minutes
    parent_job_key: "create_env"
    arguments: "--quick"
    environment:
      DATA_DIR: "data_list"
    
  # Deploy API application
  deploy_api:
    name: "Deploy SDN API"
    script: "scripts/run_sdn_api.py"
    arguments: ""
    kernel: "python3"
    runtime_id: "docker.repository.cloudera.com/cloudera/cdsw/ml-runtime-pbj-jupyterlab-python3.11-standard:2025.01.3-b8"
    cpu: 4
    memory: 8
    gpu: 0
    timeout: 86400  # 24 hours
    parent_job_key: "download_ofac_list"
    environment:
      API_HOST: "0.0.0.0"
      API_PORT: "8000"
      USE_LLM: "true"
      OPENAI_API_KEY: "${OPENAI_API_KEY}"  # Must be set in CML secrets
    
  # Deploy Flask UI
  deploy_ui:
    name: "Deploy Flask UI"
    script: "scripts/run_flask_ui.py"
    arguments: ""
    kernel: "python3"
    runtime_id: "docker.repository.cloudera.com/cloudera/cdsw/ml-runtime-pbj-jupyterlab-python3.11-standard:2025.01.3-b8"
    cpu: 2
    memory: 4
    gpu: 0
    timeout: 86400  # 24 hours
    parent_job_key: "download_ofac_list"
    environment:
      FLASK_APP: "flask_ui.app.app"
      FLASK_ENV: "production"
      USE_LLM: "true"
      OPENAI_API_KEY: "${OPENAI_API_KEY}"
